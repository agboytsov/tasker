<!DOCTYPE html>
<html>
<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous">

</script>

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>
    <script>
        $(document).on('show.bs.modal', '#exampleModal', function(e) {

  // Получаем данные из data-атрибутов кнопки, которая открыла модальное окно
  var button = $(e.relatedTarget) // Эта кнопка открыла модальное окно.
  var title = button.data('bs-whatever') // Получаем data- *  значение по имени атрибута
  var description = button.data('bs-desc')
  const task_id = button.data('bs-taskid')
  // Теперь можем использовать recipient где угодно внутри модального окна
  $('#modal_edit_title').val(title) // Показываем данные в модальном окне
  $('#modal_edit_desc').val(description)
  $('#modal_edit_id').val(task_id)

});
function editTask() {
alert();
};
function createTask(){
var formData = $(this).serialize();
console.log(formData);
alert(formData['title']);
}
$(document).ready(function() {
$("#createForm").on("submit", function(event) {
        // Предотвращаем стандартную отправку формы
        event.preventDefault();
        var object = {};
        var formData = new FormData(document.forms.createForm);

        formData.forEach(function(value, key){
            object[key] = value;
        });
    var json = JSON.stringify(object);
    console.log(json);

         $.ajax({
            url: "http://127.0.0.1:5000/api/tasks", // Путь к PHP скрипту, который обрабатывает данные
            type: "POST",
            contentType: "application/json",
            data: json,
            success: function(response) {
                // Действия в случае успешной отправки
                console.log("Задача успешно отправлена!");
                location.reload();
                // Здесь можно добавить код для отображения сообщения об успешной отправке
            },
            error: function(xhr, status, error) {
                // Действия в случае ошибки при отправке
                console.log("Произошла ошибка при отправке формы: " + xhr.responseText);
                // Здесь можно добавить код для отображения сообщения об ошибке
            }
        });
        });
$("#editForm").on("submit", function(event) {
        // Предотвращаем стандартную отправку формы
        event.preventDefault();
        var task_id = $('#modal_edit_id').val()
        var object = {};
        var formData = new FormData(document.forms.editForm);

        formData.forEach(function(value, key){
            object[key] = value;
        });
    var json = JSON.stringify(object);
    console.log(json);

         $.ajax({
            url: "http://127.0.0.1:5000/api/tasks/"+task_id, // Путь к PHP скрипту, который обрабатывает данные
            type: "PUT",
            contentType: "application/json",
            data: json,
            success: function(response) {
                // Действия в случае успешной отправки
                console.log("Форма успешно отправлена!");
                location.reload();
                // Здесь можно добавить код для отображения сообщения об успешной отправке
            },
            error: function(xhr, status, error) {
                // Действия в случае ошибки при отправке
                console.log("Произошла ошибка при отправке формы: " + xhr.responseText);
                // Здесь можно добавить код для отображения сообщения об ошибке
            }
        });
});
});

function deleteTask(tsk_id){
$.ajax({
            url: "http://127.0.0.1:5000/api/tasks/"+tsk_id, // Путь к PHP скрипту, который обрабатывает данные
            type: "DELETE",
            contentType: "application/json",
            success: function(response) {

                // Действия в случае успешной отправки
                console.log("Форма успешно отправлена!");
                location.reload();
                // Здесь можно добавить код для отображения сообщения об успешной отправке
            },
            error: function(xhr, status, error) {
                // Действия в случае ошибки при отправке
                console.log("Произошла ошибка при отправке формы: " + xhr.responseText);
                // Здесь можно добавить код для отображения сообщения об ошибке
            }
        });
}



    </script>
<!--<script>-->
<!--$(document).ready(function() {-->
<!--    // Функция для отправки данных на сервер-->
<!--    function saveData() {-->
<!--        var formData = $('#formId').serialize(); // Сериализуем данные формы-->

<!--        $.ajax({-->
<!--            url: 'http://127.0.0.1/api/tasks/'+ task_id, // URL эндпоинта-->
<!--            type: 'PUT',-->
<!--            data: formData,-->
<!--            success: function(response) {-->
<!--                if (response.success) {-->
<!--                    alert('Задача обновлена!');-->
<!--                } else {-->
<!--                    alert('Произошла ошибка при сохранении данных.');-->
<!--                }-->
<!--            },-->
<!--            error: function(jqXHR, textStatus, errorThrown) {-->
<!--                alert('Ошибка при отправке данных: ' + textStatus);-->
<!--            }-->
<!--        });-->
<!--    }-->

<!--    // Обработчик клика по кнопке "Сохранить"-->
<!--    $('#saveButton').click(function() {-->
<!--        saveData();-->
<!--    });-->
<!--});-->
<!--</script>-->
</head>
<body>
<div class="container">

    <div class="col-12">
        <div class="list-group list-group-checkable">
            <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Список задач:</h5>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createModal">+ добавить задачу</button>

                  <!-- List group with custom content -->
                  <ol class="list-group">
                      {% for task in tasks %}
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                      <div class="ms-2 me-auto">
                        <div class="fw-bold">{{task.title}}</div>
                          {{task.description}}
                      </div>
                        <div class="btn-group">
                          <a href="#" class="btn btn-outline-primary"
                             data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-taskid="{{task.id}}" data-bs-whatever="{{task.title}}" data-bs-desc="{{task.description}}">Редактировать</a>
                          <a href="#" class="btn btn-outline-danger" data-bs-task_id="" onclick="deleteTask({{task.id}})">Удалить</a>
                        </div>
                    </li>
                      {% endfor %}

                  </ol>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
        <form id="editForm">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Изменить задачу:</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

          <div class="mb-3">
              <input type="hidden" name="id" id="modal_edit_id" value="">
            <label for="modal_edit_title" class="col-form-label">Задача:</label>
            <input type="text" class="form-control" id="modal_edit_title" name="title">
          </div>
          <div class="mb-3">
            <label for="modal_edit_desc" class="col-form-label">Описание:</label>
            <textarea class="form-control" id="modal_edit_desc" name="description"></textarea>
          </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
        <button type="submit" class="btn btn-primary">Сохранить</button>
      </div>
             </form>
    </div>
  </div>
</div>

<div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
        <form id="createForm">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="createModalLabel">Создать задачу:</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

          <div class="mb-3">
            <label for="modal_edit_title" class="col-form-label" >Задача:</label>
            <input type="text" class="form-control" id="modal_create_title" name="title">
          </div>
          <div class="mb-3">
            <label for="modal_edit_desc" class="col-form-label">Описание:</label>
            <textarea class="form-control" id="modal_create_desc" name="description"></textarea>
          </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
        <button type="submit" class="btn btn-primary"  data-bs-dismiss="modal">Сохранить</button>
      </div>
            </form>
    </div>
  </div>
</div>
<div id="alert" style="display: none;">
  <div class="alert alert-success" role="alert">
    Success Alert!
  </div>
</div>

<script>
function showAlert() {
  var alertElement = document.getElementById('alert');
  if (!alertElement.classList.contains('show')) {
    // Показываем алерт
    alertElement.style.display = 'block';
    alertElement.classList.add('show');

    // Закрываем алерт через 3 секунды
    //setTimeout(function() {
    //  hideAlert();
    //}, 3000000);
  } else {
    // Если алерт уже открыт, просто скрываем его
    hideAlert();
  }
}

function hideAlert() {
  var alertElement = document.getElementById('alert');
  alertElement.style.display = 'none';
  alertElement.classList.remove('show');
}
</script>
</body>
</html>